type: v1/system
$parameters:
  node_pool:
    type: string
  num_instances:
    type: number
    default: 1

node_pool: ${node_pool}
num_instances: ${num_instances}

components:
  zookeeper:
    type: v1/service
    node_pool: /:main
    num_instances: 1

    build:
      type: docker_image
      repository: confluentinc/cp-zookeeper
      tag: 5.0.0
    ports:
      "2181":
        protocol: TCP
    exec:
      environment:
        ZOOKEEPER_CLIENT_PORT: "2181"
  kafka:
    type: v1/service
    node_pool: /:main
    num_instances: 1

    build:
      type: docker_image
      repository: confluentinc/cp-kafka
      tag: 5.0.0
    exec:
      environment:
        KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
        KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
        KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: "1"
    ports:
      "9092":
        protocol: TCP


  kafka_manager:
    type: v1/service
    node_pool: /:main
    num_instances: 1

    build:
      type: docker_image
      repository: sheepkiller/kafka-manager
      tag: stable
    exec:
      environment:
        ZK_HOSTS: zookeeper:2181
    ports:
      "9000":
        protocol: HTTP
        external_access:
          public: true

  schema_registry:
    type: v1/service
    node_pool: /:main
    num_instances: 1

    build:
      type: docker_image
      repository: confluentinc/cp-schema-registry
      tag: 5.0.0
    exec:
      environment:
        SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL: zookeeper:2181
        SCHEMA_REGISTRY_HOST_NAME: schema_registry
        SCHEMA_REGISTRY_LISTENERS: http://0.0.0.0:8081
    ports:
      "8081":
        protocol: TCP


  kafka_rest:
    type: v1/service
    node_pool: /:main
    num_instances: 1

    build:
      type: docker_image
      repository: confluentinc/cp-kafka-rest
      tag: 5.0.0
    exec:
      environment:
        KAFKA_REST_ZOOKEEPER: zookeeper:2181
        KAFKA_REST_LISTENERS: http://0.0.0.0:8082
        KAFKA_REST_SCHEMA_REGISTRY_URL: http://schema_registry:8081
        KAFKA_REST_HOST_NAME: kafka_rest
    ports:
      "8082":
        protocol: HTTP
        external_access:
          public: true

